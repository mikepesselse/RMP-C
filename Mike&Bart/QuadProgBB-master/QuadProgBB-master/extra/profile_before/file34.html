<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /><title>Function details for qpsub</title><link rel="stylesheet" href="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">qpsub (110 calls, 1.914 sec)</span><br/><i>Generated 06-Oct-2011 17:14:14 using cpu time.</i><br/>M-function in file /usr/local/apps/matlab78/toolbox/shared/optimlib/qpsub.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file29.html">quadprog</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">77</td></tr><tr><td class="td-linebottomrt"><a href="file34.html">qpsub</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">33</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line645">645</a></td><td class="td-linebottomrt"><pre>[Q,R] = qrinsert(Q,R,CIND,A(in...</pre></td><td class="td-linebottomrt">717</td><td class="td-linebottomrt">0.316 s</td><td class="td-linebottomrt" class="td-linebottomrt">16.5%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=16 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line713">713</a></td><td class="td-linebottomrt"><pre>[SD, dirType] = compdir(Z,H,gf...</pre></td><td class="td-linebottomrt">573</td><td class="td-linebottomrt">0.173 s</td><td class="td-linebottomrt" class="td-linebottomrt">9.0%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=9 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line692">692</a></td><td class="td-linebottomrt"><pre>[Q,R]=qrdelete(Q,R,lind);</pre></td><td class="td-linebottomrt">144</td><td class="td-linebottomrt">0.092 s</td><td class="td-linebottomrt" class="td-linebottomrt">4.8%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=5 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line155">155</a></td><td class="td-linebottomrt"><pre>[Q,R,A,B,X,Z,how,ACTSET,ACTIND...</pre></td><td class="td-linebottomrt">77</td><td class="td-linebottomrt">0.071 s</td><td class="td-linebottomrt" class="td-linebottomrt">3.7%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line339">339</a></td><td class="td-linebottomrt"><pre>[SD, dirType] = compdir(Z,H,gf...</pre></td><td class="td-linebottomrt">77</td><td class="td-linebottomrt">0.051 s</td><td class="td-linebottomrt" class="td-linebottomrt">2.7%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=3 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">1.211 s</td><td class="td-linebottomrt">63.3%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=63 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">1.914 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file36.html">qrinsert</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">717</td><td class="td-linebottomrt">0.305 s</td><td class="td-linebottomrt">16.0%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=16 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file39.html">compdir</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">650</td><td class="td-linebottomrt">0.214 s</td><td class="td-linebottomrt">11.2%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=11 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file37.html">qrdelete</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">144</td><td class="td-linebottomrt">0.092 s</td><td class="td-linebottomrt">4.8%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=5 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file35.html">qpsub>eqnsolv</a></td><td class="td-linebottomrt">M-subfunction</td><td class="td-linebottomrt">77</td><td class="td-linebottomrt">0.071 s</td><td class="td-linebottomrt">3.7%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=4 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file41.html">pinv</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">22</td><td class="td-linebottomrt">0.010 s</td><td class="td-linebottomrt">0.5%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=1 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file34.html">qpsub</a></td><td class="td-linebottomrt">M-function</td><td class="td-linebottomrt">33</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">1.222 s</td><td class="td-linebottomrt">63.8%</td><td class="td-linebottomrt"><img src="file:////usr/local/apps/matlab78/toolbox/matlab/codetools/private/one-pixel.gif" width=64 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">1.914 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>M-Lint results</strong><br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Message</td></tr><tr><td class="td-linebottomrt"><a href="#Line21">21</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'Lp' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line23">23</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'Nlconst' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line132">132</a></td><td class="td-linebottomrt"><span class="mono">Use FIND with the 'first' or 'last' option.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line152">152</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'remove' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line174">174</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'err' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line267">267</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'exitflagS' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line267">267</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'outputS' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line267">267</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'howS' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line267">267</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'ACTIND2' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line329">329</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'm' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line329">329</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'n' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line387">387</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'oldind' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line415">415</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'dist' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line415">415</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'ind2' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line418">418</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'ind2' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line419">419</a></td><td class="td-linebottomrt"><span class="mono">Use FIND with the 'first' or 'last' option.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line537">537</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'dist' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line537">537</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'ind2' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line540">540</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'ind2' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line541">541</a></td><td class="td-linebottomrt"><span class="mono">Use FIND with the 'first' or 'last' option.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line583">583</a></td><td class="td-linebottomrt"><span class="mono">Using ISEMPTY is usually faster than comparing LENGTH to 0.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line609">609</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'delete_constr' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line644">644</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'm' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line644">644</a></td><td class="td-linebottomrt"><span class="mono">The value assigned to variable 'n' might be unused.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line675">675</a></td><td class="td-linebottomrt"><span class="mono">Using ISEMPTY is usually faster than comparing LENGTH to 0.</span></td></tr><tr><td class="td-linebottomrt"><a href="#Line787">787</a></td><td class="td-linebottomrt"><span class="mono">Using ISEMPTY is usually faster than comparing LENGTH to 0.</span></td></tr></table><div class="grayline"/><strong>Coverage results</strong><br/>[ Show coverage for parent directory ]<br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">840</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">204</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">636</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">302</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">334</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">47.48 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #228B22; background: #FFFFFF;">    qpsub(H,f,A,B,lb,ub,X,neqcstr,verbosity,caller,ncstr, ...</span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #228B22; background: #FFFFFF;">    numberOfVariables,options,ACTIND,phaseOneTotalScaling)</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;">%QPSUB solves quadratic programming problems. </span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   6</span> <span style="color: #228B22; background: #FFFFFF;">%   X = QPSUB(H,f,A,b) solves the quadratic programming problem:</span><br/>               <span style="color: #A0A0A0">   7</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">   8</span> <span style="color: #228B22; background: #FFFFFF;">%            min 0.5*x'Hx + f'x   subject to:  Ax &lt;= b </span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;">%             x    </span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  11</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #228B22; background: #FFFFFF;">%   Copyright 1990-2008 The MathWorks, Inc. </span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #228B22; background: #FFFFFF;">%   $Revision: 1.1.4.9 $  $Date: 2008/12/01 07:40:35 $</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #228B22; background: #FFFFFF;">% Define constant strings</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  16</span> <span style="color: #000000; background: #FFFFFF;">NewtonStep = 'Newton'; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  17</span> <span style="color: #000000; background: #FFFFFF;">NegCurv = 'negative curvature chol';    </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  18</span> <span style="color: #000000; background: #FFFFFF;">ZeroStep = 'zero step'; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  19</span> <span style="color: #000000; background: #FFFFFF;">SteepDescent = 'steepest descent'; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  20</span> <span style="color: #000000; background: #FFFFFF;">Conls = 'lsqlin'; </span><br/><a name="Line21"></a>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  21</span> <span style="color: #000000; background: #FFFFFF;">Lp = 'linprog'; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  22</span> <span style="color: #000000; background: #FFFFFF;">Qpsub = '<a href="file34.html">qpsub</a>'; </span><br/><a name="Line23"></a>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  23</span> <span style="color: #000000; background: #FFFFFF;">Nlconst = 'nlconst'; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  24</span> <span style="color: #000000; background: #FFFFFF;">how = 'ok';  </span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  26</span> <span style="color: #000000; background: #FFFFFF;">exitflag = 1; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  27</span> <span style="color: #000000; background: #FFFFFF;">output = []; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  28</span> <span style="color: #000000; background: #FFFFFF;">msg = []; % initialize to ensure appending is successful </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  29</span> <span style="color: #000000; background: #FFFFFF;">illCondWarningAlreadyDisplayed = false; % flag to prevent multiple display of warning </span><br/>               <span style="color: #A0A0A0">  30</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  31</span> <span style="color: #000000; background: #FFFFFF;">iterations = 0; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  32</span> <span style="color: #000000; background: #FFFFFF;">if nargin &lt; 15 </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  33</span> <span style="color: #000000; background: #FFFFFF;">    phaseOneTotalScaling = false; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  34</span> <span style="color: #000000; background: #FFFFFF;">    if nargin &lt; 14 </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  35</span> <span style="color: #000000; background: #FFFFFF;">        ACTIND = []; </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  36</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  37</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  38</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  39</span> <span style="color: #000000; background: #FFFFFF;">lb=lb(:); ub = ub(:); </span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  41</span> <span style="color: #000000; background: #FFFFFF;">if isempty(verbosity), verbosity = 1; end </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  42</span> <span style="color: #000000; background: #FFFFFF;">if isempty(neqcstr), neqcstr = 0; end </span><br/>               <span style="color: #A0A0A0">  43</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  44</span> <span style="color: #000000; background: #FFFFFF;">LLS = 0; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  45</span> <span style="color: #000000; background: #FFFFFF;">if strcmp(caller, Conls) </span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #A0A0A0; background: #FFFFFF;">    LLS = 1;</span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #A0A0A0; background: #FFFFFF;">    [rowH,colH]=size(H);</span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #A0A0A0; background: #FFFFFF;">    numberOfVariables = colH;</span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  50</span> <span style="color: #000000; background: #FFFFFF;">if strcmp(caller, Qpsub) </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold">  51</span> <span style="color: #000000; background: #FFFFFF;">    normalize = -1; </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  52</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  53</span> <span style="color: #000000; background: #FFFFFF;">    normalize = 1; </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  54</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  55</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  56</span> <span style="color: #000000; background: #FFFFFF;">simplex_iter = 0; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  57</span> <span style="color: #000000; background: #FFFFFF;">if  norm(H,'inf')==0 || isempty(H) </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold">  58</span> <span style="color: #000000; background: #FFFFFF;">    is_qp = 0;  </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  59</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  60</span> <span style="color: #000000; background: #FFFFFF;">    is_qp=1;  </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  61</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  63</span> <span style="color: #000000; background: #FFFFFF;">if LLS==1 </span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #A0A0A0; background: #FFFFFF;">    is_qp=0;</span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  67</span> <span style="color: #000000; background: #FFFFFF;">normf = 1; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  68</span> <span style="color: #000000; background: #FFFFFF;">if normalize &gt; 0 </span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #228B22; background: #FFFFFF;">    % Check for lp</span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  70</span> <span style="color: #000000; background: #FFFFFF;">    if ~is_qp &amp;&amp; ~LLS </span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #A0A0A0; background: #FFFFFF;">        normf = norm(f);</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if normf &gt; 0</span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #A0A0A0; background: #FFFFFF;">            f = f./normf;</span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">  75</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  76</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">% Handle bounds as linear constraints</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  79</span> <span style="color: #000000; background: #FFFFFF;">arglb = ~eq(lb,-inf); </span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  80</span> <span style="color: #000000; background: #FFF0F0;">lenlb=length(lb); % maybe less than numberOfVariables due to old code </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  81</span> <span style="color: #000000; background: #FFFFFF;">if nnz(arglb) &gt; 0      </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  82</span> <span style="color: #000000; background: #FFFFFF;">    lbmatrix = -eye(lenlb,numberOfVariables); </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  83</span> <span style="color: #000000; background: #FFFFFF;">    A=[A; lbmatrix(arglb,1:numberOfVariables)]; % select non-Inf bounds </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  84</span> <span style="color: #000000; background: #FFFFFF;">    B=[B;-lb(arglb)]; </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  85</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  87</span> <span style="color: #000000; background: #FFFFFF;">argub = ~eq(ub,inf); </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  88</span> <span style="color: #000000; background: #FFF0F0;">lenub=length(ub); </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  89</span> <span style="color: #000000; background: #FFFFFF;">if nnz(argub) &gt; 0 </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  90</span> <span style="color: #000000; background: #FFFFFF;">    ubmatrix = eye(lenub,numberOfVariables); </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  91</span> <span style="color: #000000; background: #FFFFFF;">    A=[A; ubmatrix(argub,1:numberOfVariables)]; </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  92</span> <span style="color: #000000; background: #FFFFFF;">    B=[B; ub(argub)]; </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold">  93</span> <span style="color: #000000; background: #FFFFFF;">end  </span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #228B22; background: #FFFFFF;">% Bounds are treated as constraints: Reset ncstr accordingly</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  96</span> <span style="color: #000000; background: #FFF0F0;">ncstr=ncstr + nnz(arglb) + nnz(argub); </span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #228B22; background: #FFFFFF;">% Figure out max iteration count and constraint tolerance</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold">  99</span> <span style="color: #000000; background: #FFFFFF;">maxiter = options.MaxIter; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 100</span> <span style="color: #000000; background: #FFFFFF;">tolCon  = options.TolCon; </span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">% Used for determining threshold for whether a direction will violate</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">% a constraint.</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 104</span> <span style="color: #000000; background: #FFFFFF;">normA = ones(ncstr,1); </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 105</span> <span style="color: #000000; background: #FFFFFF;">if normalize &gt; 0  </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 106</span> <span style="color: #000000; background: #FFFFFF;">    for i=1:ncstr </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 107</span> <span style="color: #000000; background: #FFFFFF;">        n = norm(A(i,:)); </span><br/>       <span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 108</span> <span style="color: #000000; background: #FFFFFF;">        if (n ~= 0) </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 109</span> <span style="color: #000000; background: #FFFFFF;">            A(i,:) = A(i,:)/n; </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 110</span> <span style="color: #000000; background: #FFFFFF;">            B(i) = B(i)/n; </span><br/>       <span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 111</span> <span style="color: #000000; background: #FFFFFF;">            normA(i,1) = n; </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 112</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   4377 </span><span style="color: #000000; font-weight: bold"> 113</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 114</span> <span style="color: #228B22; background: #FFFFFF;">else  </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 115</span> <span style="color: #000000; background: #FFFFFF;">    normA = ones(ncstr,1); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 116</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 117</span> <span style="color: #000000; background: #FFFFFF;">errnorm = 0.01*sqrt(eps);  </span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 119</span> <span style="color: #000000; background: #FFFFFF;">tolDep = 100*numberOfVariables*eps; </span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">% Save the original number of constraints in origncstr, since ncstr will change if dependent </span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">% constraints are eliminated in eqnsolve.</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 122</span> <span style="color: #000000; background: #FFFFFF;">origncstr = ncstr; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 123</span> <span style="color: #000000; background: #FFFFFF;">lambda = zeros(origncstr,1); </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 124</span> <span style="color: #000000; background: #FFFFFF;">eqix = 1:neqcstr; </span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #228B22; background: #FFFFFF;">% Modifications for warm-start.</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">% Do some error checking on the incoming working set indices.</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 128</span> <span style="color: #000000; background: #FFFFFF;">ACTCNT = length(ACTIND); </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 129</span> <span style="color: #000000; background: #FFFFFF;">if isempty(ACTIND) </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 130</span> <span style="color: #000000; background: #FFFFFF;">    ACTIND = eqix; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 131</span> <span style="color: #000000; background: #FFFFFF;">elseif neqcstr &gt; 0 </span><br/><a name="Line132"></a>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 132</span> <span style="color: #000000; background: #FFFFFF;">    i = max(find(ACTIND&lt;=neqcstr)); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 133</span> <span style="color: #000000; background: #FFFFFF;">    if isempty(i) || i &gt; neqcstr % safeguard which should not occur </span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND = eqix;</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 135</span> <span style="color: #000000; background: #FFFFFF;">    elseif i &lt; neqcstr </span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #228B22; background: #FFFFFF;">        % A redundant equality constraint was removed on the last</span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">        % SQP iteration.  We will go ahead and reinsert it here.</span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #A0A0A0; background: #FFFFFF;">        numremoved = neqcstr - i;</span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND(neqcstr+1:ACTCNT+numremoved) = ACTIND(i+1:ACTCNT);</span><br/>               <span style="color: #A0A0A0"> 140</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND(1:neqcstr) = eqix;</span><br/>               <span style="color: #A0A0A0"> 141</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 142</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 143</span> <span style="color: #000000; background: #FFFFFF;">aix = zeros(ncstr,1); </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 144</span> <span style="color: #000000; background: #FFFFFF;">aix(ACTIND) = 1; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 145</span> <span style="color: #000000; background: #FFFFFF;">ACTCNT = length(ACTIND); </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 146</span> <span style="color: #000000; background: #FFFFFF;">ACTSET = A(ACTIND,:); </span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #228B22; background: #FFFFFF;">% Check that the constraints in the initial working set are</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">% not dependent and find an initial point which satisfies the</span><br/>               <span style="color: #A0A0A0"> 150</span> <span style="color: #228B22; background: #FFFFFF;">% initial working set.</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 151</span> <span style="color: #000000; background: #FFFFFF;">indepInd = 1:ncstr; </span><br/><a name="Line152"></a><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 152</span> <span style="color: #000000; background: #FFFFFF;">remove = []; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 153</span> <span style="color: #000000; background: #FFFFFF;">if ACTCNT &gt; 0 &amp;&amp; normalize ~= -1 </span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">    % call constraint solver</span><br/><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 155</span> <a name="Line155"></a><span style="color: #000000; background: #FFE2E2;">    [Q,R,A,B,X,Z,how,ACTSET,ACTIND,ACTCNT,aix,eqix,neqcstr,ncstr, ... </span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #000000; background: #FFE2E2;">            remove,exitflag,msg]= ...</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #000000; background: #FFE2E2;">        eqnsolv(A,B,eqix,neqcstr,ncstr,numberOfVariables,LLS,H,X,f, ...</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #000000; background: #FFE2E2;">        normf,normA,verbosity,aix,ACTSET,ACTIND,ACTCNT,how,exitflag); </span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 160</span> <span style="color: #000000; background: #FFFFFF;">    if ~isempty(remove) </span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #A0A0A0; background: #FFFFFF;">        indepInd(remove)=[];</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #A0A0A0; background: #FFFFFF;">        normA = normA(indepInd);</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 165</span> <span style="color: #000000; background: #FFFFFF;">    if strcmp(how,'infeasible') </span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #228B22; background: #FFFFFF;">        % Equalities are inconsistent, so X and lambda have no valid values</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #228B22; background: #FFFFFF;">        % Return original X and zeros for lambda.</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #A0A0A0; background: #FFFFFF;">        output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #A0A0A0; background: #FFFFFF;">        exitflag = -2;</span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #A0A0A0; background: #FFFFFF;">        return</span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><a name="Line174"></a>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 174</span> <span style="color: #000000; background: #FFFFFF;">    err = 0; </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 175</span> <span style="color: #000000; background: #FFFFFF;">    if neqcstr &gt;= numberOfVariables </span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #A0A0A0; background: #FFFFFF;">        err = max(abs(A(eqix,:)*X-B(eqix)));</span><br/>               <span style="color: #A0A0A0"> 177</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if (err &gt; 1e-8)  % Equalities not met</span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #A0A0A0; background: #FFFFFF;">            how='infeasible';</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #A0A0A0; background: #FFFFFF;">            exitflag = -2;</span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #A0A0A0; background: #FFFFFF;">            msg = sprintf(['Exiting: the equality constraints are overly stringent;\n' ...</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                  ' there is no feasible solution.']);</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if verbosity &gt; 0 </span><br/>               <span style="color: #A0A0A0"> 183</span> <span style="color: #A0A0A0; background: #FFFFFF;">                disp(msg)</span><br/>               <span style="color: #A0A0A0"> 184</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;">            % Equalities are inconsistent, X and lambda have no valid values</span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #228B22; background: #FFFFFF;">            % Return original X and zeros for lambda.</span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 188</span> <span style="color: #A0A0A0; background: #FFFFFF;">            output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #A0A0A0; background: #FFFFFF;">            return</span><br/>               <span style="color: #A0A0A0"> 190</span> <span style="color: #228B22; background: #FFFFFF;">        else % Check inequalities</span><br/>               <span style="color: #A0A0A0"> 191</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if (max(A*X-B) &gt; 1e-8)</span><br/>               <span style="color: #A0A0A0"> 192</span> <span style="color: #A0A0A0; background: #FFFFFF;">                how = 'infeasible';</span><br/>               <span style="color: #A0A0A0"> 193</span> <span style="color: #A0A0A0; background: #FFFFFF;">                exitflag = -2;</span><br/>               <span style="color: #A0A0A0"> 194</span> <span style="color: #A0A0A0; background: #FFFFFF;">                msg = sprintf(['Exiting: the constraints or bounds are overly stringent;\n' ...</span><br/>               <span style="color: #A0A0A0"> 195</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                      ' there is no feasible solution. Equality constraints have been met.']);</span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    disp(msg)</span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 200</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">        % Disable the warnings about conditioning for singular and</span><br/>               <span style="color: #A0A0A0"> 202</span> <span style="color: #228B22; background: #FFFFFF;">        % nearly singular matrices</span><br/>               <span style="color: #A0A0A0"> 203</span> <span style="color: #A0A0A0; background: #FFFFFF;">        warningstate1 = warning('off', 'MATLAB:nearlySingularMatrix');</span><br/>               <span style="color: #A0A0A0"> 204</span> <span style="color: #A0A0A0; background: #FFFFFF;">        warningstate2 = warning('off', 'MATLAB:singularMatrix');</span><br/>               <span style="color: #A0A0A0"> 205</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if is_qp</span><br/>               <span style="color: #A0A0A0"> 206</span> <span style="color: #A0A0A0; background: #FFFFFF;">            actlambda = -R\(Q'*(H*X+f));</span><br/>               <span style="color: #A0A0A0"> 207</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif LLS</span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #A0A0A0; background: #FFFFFF;">            actlambda = -R\(Q'*(H'*(H*X-f)));</span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 210</span> <span style="color: #A0A0A0; background: #FFFFFF;">            actlambda = -R\(Q'*f);</span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 212</span> <span style="color: #228B22; background: #FFFFFF;">        % Restore the warning states to their original settings</span><br/>               <span style="color: #A0A0A0"> 213</span> <span style="color: #A0A0A0; background: #FFFFFF;">        warning(warningstate1)</span><br/>               <span style="color: #A0A0A0"> 214</span> <span style="color: #A0A0A0; background: #FFFFFF;">        warning(warningstate2)</span><br/>               <span style="color: #A0A0A0"> 215</span> <span style="color: #A0A0A0; background: #FFFFFF;">        lambda(indepInd(ACTIND)) = normf * (actlambda ./normA(ACTIND));</span><br/>               <span style="color: #A0A0A0"> 216</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 217</span> <span style="color: #A0A0A0; background: #FFFFFF;">        output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 218</span> <span style="color: #A0A0A0; background: #FFFFFF;">        return</span><br/>               <span style="color: #A0A0A0"> 219</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 220</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 221</span> <span style="color: #228B22; background: #FFFFFF;">    % Check whether in Phase 1 of feasibility point finding. </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 222</span> <span style="color: #000000; background: #FFFFFF;">    if (verbosity == -2) </span><br/>               <span style="color: #A0A0A0"> 223</span> <span style="color: #A0A0A0; background: #FFFFFF;">        cstr = A*X-B; </span><br/>               <span style="color: #A0A0A0"> 224</span> <span style="color: #A0A0A0; background: #FFFFFF;">        mc=max(cstr(neqcstr+1:ncstr));</span><br/>               <span style="color: #A0A0A0"> 225</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if (mc &gt; 0)</span><br/>               <span style="color: #A0A0A0"> 226</span> <span style="color: #A0A0A0; background: #FFFFFF;">            X(numberOfVariables) = mc + 1;</span><br/>               <span style="color: #A0A0A0"> 227</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 228</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 229</span> <span style="color: #228B22; background: #FFFFFF;">else  </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 230</span> <span style="color: #000000; background: #FFFFFF;">    if ACTCNT == 0 % initial working set is empty  </span><br/>               <span style="color: #A0A0A0"> 231</span> <span style="color: #A0A0A0; background: #FFFFFF;">        Q = eye(numberOfVariables,numberOfVariables);</span><br/>               <span style="color: #A0A0A0"> 232</span> <span style="color: #A0A0A0; background: #FFFFFF;">        R = [];</span><br/>               <span style="color: #A0A0A0"> 233</span> <span style="color: #A0A0A0; background: #FFFFFF;">        Z = 1;</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 234</span> <span style="color: #228B22; background: #FFFFFF;">    else           % in Phase I and working set not empty </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 235</span> <span style="color: #000000; background: #FFFFFF;">        [Q,R] = qr(ACTSET'); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 236</span> <span style="color: #000000; background: #FFFFFF;">        Z = Q(:,ACTCNT+1:numberOfVariables); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 237</span> <span style="color: #000000; background: #FFFFFF;">    end    </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 238</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 239</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 240</span> <span style="color: #228B22; background: #FFFFFF;">% Find Initial Feasible Solution</span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 241</span> <span style="color: #000000; background: #FFFFFF;">cstr = A*X-B; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 242</span> <span style="color: #000000; background: #FFFFFF;">mc = 0; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 243</span> <span style="color: #000000; background: #FFFFFF;">tolCon_scaled = eps; </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 244</span> <span style="color: #000000; background: #FFFFFF;">if ncstr &gt; neqcstr </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 245</span> <span style="color: #000000; background: #FFFFFF;">    [mc,id] = max(cstr(neqcstr+1:ncstr)); </span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 246</span> <span style="color: #000000; background: #FFFFFF;">    if ~isempty(tolCon) </span><br/>               <span style="color: #A0A0A0"> 247</span> <span style="color: #228B22; background: #FFFFFF;">       % Constraint tolerance need to be unscaled by the</span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #228B22; background: #FFFFFF;">       % norm of the constraint that is violated by the </span><br/>               <span style="color: #A0A0A0"> 249</span> <span style="color: #228B22; background: #FFFFFF;">       % largest amount.</span><br/>               <span style="color: #A0A0A0"> 250</span> <span style="color: #A0A0A0; background: #FFFFFF;">       tolCon_scaled = tolCon/normA(neqcstr+id);</span><br/>               <span style="color: #A0A0A0"> 251</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 252</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 253</span> <span style="color: #000000; background: #FFFFFF;">if mc &gt; tolCon_scaled </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 254</span> <span style="color: #000000; background: #FFFFFF;">     quiet = -2; </span><br/>               <span style="color: #A0A0A0"> 255</span> <span style="color: #228B22; background: #FFFFFF;">    % Feasible point finding phase for qpsub</span><br/>               <span style="color: #A0A0A0"> 256</span> <span style="color: #228B22; background: #FFFFFF;">    % Use default options for qpsub in phase 1 </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 257</span> <span style="color: #000000; background: #FFFFFF;">    qpoptionsPhase1.MaxIter = 10*max(numberOfVariables,ncstr-neqcstr); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 258</span> <span style="color: #000000; background: #FFFFFF;">    qpoptionsPhase1.TolCon = options.TolCon; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 259</span> <span style="color: #000000; background: #FFFFFF;">    ACTIND2 = 1:neqcstr; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 260</span> <span style="color: #000000; background: #FFFFFF;">    if ~phaseOneTotalScaling  </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 261</span> <span style="color: #000000; background: #FFFFFF;">      A2=[[A;zeros(1,numberOfVariables)],[zeros(neqcstr,1);-ones(ncstr+1-neqcstr,1)]]; </span><br/>               <span style="color: #A0A0A0"> 262</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 263</span> <span style="color: #228B22; background: #FFFFFF;">      % Scale the slack variable as well</span><br/>               <span style="color: #A0A0A0"> 264</span> <span style="color: #A0A0A0; background: #FFFFFF;">      A2 = [[A [zeros(neqcstr,1);-ones(ncstr-neqcstr,1)]./normA]; ...</span><br/>               <span style="color: #A0A0A0"> 265</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [zeros(1,numberOfVariables) -1]];</span><br/>               <span style="color: #A0A0A0"> 266</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><a name="Line267"></a><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 267</span> <span style="color: #000000; background: #FFFFFF;">    [XS,lambdaS,exitflagS,outputS,howS,ACTIND2] = ... </span><br/>               <span style="color: #A0A0A0"> 268</span> <span style="color: #000000; background: #FFFFFF;">        qpsub([],[zeros(numberOfVariables,1);1],A2,[B;1e-5], ...</span><br/>               <span style="color: #A0A0A0"> 269</span> <span style="color: #000000; background: #FFFFFF;">        [],[],[X;mc+1],neqcstr,quiet,Qpsub,size(A2,1),numberOfVariables+1, ...</span><br/>               <span style="color: #A0A0A0"> 270</span> <span style="color: #000000; background: #FFFFFF;">        qpoptionsPhase1,ACTIND2);</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 271</span> <span style="color: #000000; background: #FFFFFF;">    slack = XS(numberOfVariables+1); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 272</span> <span style="color: #000000; background: #FFFFFF;">    X=XS(1:numberOfVariables); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 273</span> <span style="color: #000000; background: #FFFFFF;">    cstr=A*X-B; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 274</span> <span style="color: #000000; background: #FFFFFF;">    [mc,id] = max(cstr(neqcstr+1:ncstr)); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 275</span> <span style="color: #000000; background: #FFFFFF;">    if ~isempty(tolCon) </span><br/>               <span style="color: #A0A0A0"> 276</span> <span style="color: #228B22; background: #FFFFFF;">       % Constraint tolerance need to be unscaled by the</span><br/>               <span style="color: #A0A0A0"> 277</span> <span style="color: #228B22; background: #FFFFFF;">       % norm of the constraint that is violated by the </span><br/>               <span style="color: #A0A0A0"> 278</span> <span style="color: #228B22; background: #FFFFFF;">       % largest amount.</span><br/>               <span style="color: #A0A0A0"> 279</span> <span style="color: #A0A0A0; background: #FFFFFF;">       tolCon_scaled = tolCon/normA(neqcstr+id);</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 280</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 281</span> <span style="color: #000000; background: #FFFFFF;">        tolCon_scaled = eps; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 282</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 283</span> <span style="color: #000000; background: #FFFFFF;">    if slack &gt; tolCon_scaled </span><br/>               <span style="color: #A0A0A0"> 284</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if slack &gt; 1e-8 </span><br/>               <span style="color: #A0A0A0"> 285</span> <span style="color: #A0A0A0; background: #FFFFFF;">            how='infeasible';</span><br/>               <span style="color: #A0A0A0"> 286</span> <span style="color: #A0A0A0; background: #FFFFFF;">            exitflag = -2;</span><br/>               <span style="color: #A0A0A0"> 287</span> <span style="color: #A0A0A0; background: #FFFFFF;">            msg = sprintf(['Exiting: the constraints are overly stringent;\n' ...</span><br/>               <span style="color: #A0A0A0"> 288</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                  ' no feasible starting point found.']);</span><br/>               <span style="color: #A0A0A0"> 289</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 290</span> <span style="color: #A0A0A0; background: #FFFFFF;">                disp(msg)</span><br/>               <span style="color: #A0A0A0"> 291</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 292</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 293</span> <span style="color: #A0A0A0; background: #FFFFFF;">            how = 'overly constrained';</span><br/>               <span style="color: #A0A0A0"> 294</span> <span style="color: #A0A0A0; background: #FFFFFF;">            exitflag = -2;</span><br/>               <span style="color: #A0A0A0"> 295</span> <span style="color: #A0A0A0; background: #FFFFFF;">            msg = sprintf(['Exiting: the constraints are overly stringent;\n' ...</span><br/>               <span style="color: #A0A0A0"> 296</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                  ' initial feasible point found violates constraints\n' ...</span><br/>               <span style="color: #A0A0A0"> 297</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                  ' by more than eps.']);</span><br/>               <span style="color: #A0A0A0"> 298</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 299</span> <span style="color: #A0A0A0; background: #FFFFFF;">                disp(msg)</span><br/>               <span style="color: #A0A0A0"> 300</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 301</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 302</span> <span style="color: #A0A0A0; background: #FFFFFF;">        lambda(indepInd) = normf * (lambdaS((1:ncstr)')./normA);</span><br/>               <span style="color: #A0A0A0"> 303</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND = 1:neqcstr;</span><br/>               <span style="color: #A0A0A0"> 304</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 305</span> <span style="color: #A0A0A0; background: #FFFFFF;">        output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 306</span> <span style="color: #A0A0A0; background: #FFFFFF;">        return</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 307</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>               <span style="color: #A0A0A0"> 308</span> <span style="color: #228B22; background: #FFFFFF;">        % Initialize active set info based on solution of Phase I.</span><br/>               <span style="color: #A0A0A0"> 309</span> <span style="color: #228B22; background: #FFFFFF;">        %      ACTIND = ACTIND2(find(ACTIND2&lt;=ncstr));</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 310</span> <span style="color: #000000; background: #FFFFFF;">        ACTIND = 1:neqcstr; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 311</span> <span style="color: #000000; background: #FFFFFF;">        ACTSET = A(ACTIND,:); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 312</span> <span style="color: #000000; background: #FFFFFF;">        ACTCNT = length(ACTIND); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 313</span> <span style="color: #000000; background: #FFFFFF;">        aix = zeros(ncstr,1); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 314</span> <span style="color: #000000; background: #FFFFFF;">        aix(ACTIND) = 1; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 315</span> <span style="color: #000000; background: #FFFFFF;">        if ACTCNT == 0 </span><br/>               <span style="color: #A0A0A0"> 316</span> <span style="color: #A0A0A0; background: #FFFFFF;">            Q = zeros(numberOfVariables,numberOfVariables);</span><br/>               <span style="color: #A0A0A0"> 317</span> <span style="color: #A0A0A0; background: #FFFFFF;">            R = [];</span><br/>               <span style="color: #A0A0A0"> 318</span> <span style="color: #A0A0A0; background: #FFFFFF;">            Z = 1;</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 319</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 320</span> <span style="color: #000000; background: #FFFFFF;">            [Q,R] = qr(ACTSET'); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 321</span> <span style="color: #000000; background: #FFFFFF;">            Z = Q(:,ACTCNT+1:numberOfVariables); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 322</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 323</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 324</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 325</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 326</span> <span style="color: #000000; background: #FFFFFF;">if ACTCNT &gt;= numberOfVariables - 1   </span><br/>               <span style="color: #A0A0A0"> 327</span> <span style="color: #A0A0A0; background: #FFFFFF;">    simplex_iter = 1; </span><br/>               <span style="color: #A0A0A0"> 328</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/><a name="Line329"></a><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 329</span> <span style="color: #000000; background: #FFFFFF;">[m,n]=size(ACTSET); </span><br/>               <span style="color: #A0A0A0"> 330</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 331</span> <span style="color: #228B22; background: #FFFFFF;">% Disable the warnings about conditioning for singular and</span><br/>               <span style="color: #A0A0A0"> 332</span> <span style="color: #228B22; background: #FFFFFF;">% nearly singular matrices</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 333</span> <span style="color: #000000; background: #FFFFFF;">warningstate1 = warning('off', 'MATLAB:nearlySingularMatrix'); </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 334</span> <span style="color: #000000; background: #FFFFFF;">warningstate2 = warning('off', 'MATLAB:singularMatrix'); </span><br/>               <span style="color: #A0A0A0"> 335</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 336</span> <span style="color: #000000; background: #FFFFFF;">if (is_qp) </span><br/>       <span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 337</span> <span style="color: #000000; background: #FFFFFF;">    gf=H*X+f; </span><br/>               <span style="color: #A0A0A0"> 338</span> <span style="color: #228B22; background: #FFFFFF;">    %  SD=-Z*((Z'*H*Z)\(Z'*gf));</span><br/><span style="color: #FF0000">  0.05 </span><span style="color: #0000FF">     77 </span><span style="color: #000000; font-weight: bold"> 339</span> <a name="Line339"></a><span style="color: #000000; background: #FFF0F0;">    [SD, dirType] = <a href="file39.html">compdir</a>(Z,H,gf,numberOfVariables,f); </span><br/>               <span style="color: #A0A0A0"> 340</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 341</span> <span style="color: #228B22; background: #FFFFFF;">    % Check for -ve definite problems:</span><br/>               <span style="color: #A0A0A0"> 342</span> <span style="color: #228B22; background: #FFFFFF;">    %  if SD'*gf&gt;0, is_qp = 0; SD=-SD; end</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 343</span> <span style="color: #000000; background: #FFFFFF;">elseif (LLS) </span><br/>               <span style="color: #A0A0A0"> 344</span> <span style="color: #A0A0A0; background: #FFFFFF;">    HXf=H*X-f;</span><br/>               <span style="color: #A0A0A0"> 345</span> <span style="color: #A0A0A0; background: #FFFFFF;">    gf=H'*(HXf);</span><br/>               <span style="color: #A0A0A0"> 346</span> <span style="color: #A0A0A0; background: #FFFFFF;">    HZ= H*Z;</span><br/>               <span style="color: #A0A0A0"> 347</span> <span style="color: #A0A0A0; background: #FFFFFF;">    [mm,nn]=size(HZ);</span><br/>               <span style="color: #A0A0A0"> 348</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if mm &gt;= nn</span><br/>               <span style="color: #A0A0A0"> 349</span> <span style="color: #228B22; background: #FFFFFF;">        %   SD =-Z*((HZ'*HZ)\(Z'*gf));</span><br/>               <span style="color: #A0A0A0"> 350</span> <span style="color: #A0A0A0; background: #FFFFFF;">        [QHZ, RHZ] =  qr(HZ,0);</span><br/>               <span style="color: #A0A0A0"> 351</span> <span style="color: #A0A0A0; background: #FFFFFF;">        Pd = QHZ'*HXf;</span><br/>               <span style="color: #A0A0A0"> 352</span> <span style="color: #228B22; background: #FFFFFF;">        % Now need to check which is dependent</span><br/>               <span style="color: #A0A0A0"> 353</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if min(size(RHZ))==1 % Make sure RHZ isn't a vector</span><br/>               <span style="color: #A0A0A0"> 354</span> <span style="color: #A0A0A0; background: #FFFFFF;">            depInd = find( abs(RHZ(1,1)) &lt; tolDep);</span><br/>               <span style="color: #A0A0A0"> 355</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 356</span> <span style="color: #A0A0A0; background: #FFFFFF;">            depInd = find( abs(diag(RHZ)) &lt; tolDep );</span><br/>               <span style="color: #A0A0A0"> 357</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end  </span><br/>               <span style="color: #A0A0A0"> 358</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 359</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if mm &gt;= nn &amp;&amp; isempty(depInd) % Newton step</span><br/>               <span style="color: #A0A0A0"> 360</span> <span style="color: #A0A0A0; background: #FFFFFF;">        SD = - Z*(RHZ(1:nn, 1:nn) \ Pd(1:nn,:));</span><br/>               <span style="color: #A0A0A0"> 361</span> <span style="color: #A0A0A0; background: #FFFFFF;">        dirType = NewtonStep;</span><br/>               <span style="color: #A0A0A0"> 362</span> <span style="color: #228B22; background: #FFFFFF;">    else % steepest descent direction</span><br/>               <span style="color: #A0A0A0"> 363</span> <span style="color: #A0A0A0; background: #FFFFFF;">        SD = -Z*(Z'*gf);</span><br/>               <span style="color: #A0A0A0"> 364</span> <span style="color: #A0A0A0; background: #FFFFFF;">        dirType = SteepDescent;</span><br/>               <span style="color: #A0A0A0"> 365</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 366</span> <span style="color: #228B22; background: #FFFFFF;">else % lp </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 367</span> <span style="color: #000000; background: #FFFFFF;">    gf = f; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 368</span> <span style="color: #000000; background: #FFFFFF;">    SD=-Z*Z'*gf; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 369</span> <span style="color: #000000; background: #FFFFFF;">    dirType = SteepDescent;  </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 370</span> <span style="color: #000000; background: #FFFFFF;">    if norm(SD) &lt; 1e-10 &amp;&amp; neqcstr </span><br/>               <span style="color: #A0A0A0"> 371</span> <span style="color: #228B22; background: #FFFFFF;">        % This happens when equality constraint is perpendicular</span><br/>               <span style="color: #A0A0A0"> 372</span> <span style="color: #228B22; background: #FFFFFF;">        % to objective function f.x.</span><br/>               <span style="color: #A0A0A0"> 373</span> <span style="color: #A0A0A0; background: #FFFFFF;">        actlambda = -R\(Q'*(gf));</span><br/>               <span style="color: #A0A0A0"> 374</span> <span style="color: #A0A0A0; background: #FFFFFF;">        lambda(indepInd(ACTIND)) = normf * (actlambda ./ normA(ACTIND));</span><br/>               <span style="color: #A0A0A0"> 375</span> <span style="color: #A0A0A0; background: #FFFFFF;">        ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 376</span> <span style="color: #A0A0A0; background: #FFFFFF;">        output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 377</span> <span style="color: #228B22; background: #FFFFFF;">        % Restore the warning states to their original settings</span><br/>               <span style="color: #A0A0A0"> 378</span> <span style="color: #A0A0A0; background: #FFFFFF;">        warning(warningstate1)</span><br/>               <span style="color: #A0A0A0"> 379</span> <span style="color: #A0A0A0; background: #FFFFFF;">        warning(warningstate2)</span><br/>               <span style="color: #A0A0A0"> 380</span> <span style="color: #A0A0A0; background: #FFFFFF;">        return;</span><br/>               <span style="color: #A0A0A0"> 381</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 382</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 383</span> <span style="color: #228B22; background: #FFFFFF;">% Restore the warning states to their original settings</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 384</span> <span style="color: #000000; background: #FFFFFF;">warning(warningstate1) </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 385</span> <span style="color: #000000; background: #FFFFFF;">warning(warningstate2) </span><br/>               <span style="color: #A0A0A0"> 386</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><a name="Line387"></a><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 387</span> <span style="color: #000000; background: #FFFFFF;">oldind = 0;  </span><br/>               <span style="color: #A0A0A0"> 388</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 389</span> <span style="color: #228B22; background: #FFFFFF;">% The maximum number of iterations for a simplex type method is when ncstr &gt;=n:</span><br/>               <span style="color: #A0A0A0"> 390</span> <span style="color: #228B22; background: #FFFFFF;">% maxiters = prod(1:ncstr)/(prod(1:numberOfVariables)*prod(1:max(1,ncstr-numberOfVariables)));</span><br/>               <span style="color: #A0A0A0"> 391</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 392</span> <span style="color: #228B22; background: #FFFFFF;">%--------------Main Routine-------------------</span><br/>               <span style="color: #A0A0A0"> 393</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    110 </span><span style="color: #000000; font-weight: bold"> 394</span> <span style="color: #000000; background: #FFFFFF;">while iterations &lt; maxiter </span><br/>       <span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 395</span> <span style="color: #000000; background: #FFFFFF;">    iterations = iterations + 1; </span><br/>       <span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 396</span> <span style="color: #000000; background: #FFFFFF;">    if isinf(verbosity) </span><br/>               <span style="color: #A0A0A0"> 397</span> <span style="color: #A0A0A0; background: #FFFFFF;">      curr_out = sprintf('Iter: %5.0f, Active: %5.0f, step: %s, proc: %s',iterations,ACTCNT,dirType,how);</span><br/>               <span style="color: #A0A0A0"> 398</span> <span style="color: #A0A0A0; background: #FFFFFF;">        disp(curr_out); </span><br/>               <span style="color: #A0A0A0"> 399</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 400</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 401</span> <span style="color: #228B22; background: #FFFFFF;">    % Find distance we can move in search direction SD before a </span><br/>               <span style="color: #A0A0A0"> 402</span> <span style="color: #228B22; background: #FFFFFF;">    % constraint is violated.</span><br/>               <span style="color: #A0A0A0"> 403</span> <span style="color: #228B22; background: #FFFFFF;">    % Gradient with respect to search direction.</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 404</span> <span style="color: #000000; background: #FFFFFF;">    GSD=A*SD; </span><br/>               <span style="color: #A0A0A0"> 405</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 406</span> <span style="color: #228B22; background: #FFFFFF;">    % Note: we consider only constraints whose gradients are greater</span><br/>               <span style="color: #A0A0A0"> 407</span> <span style="color: #228B22; background: #FFFFFF;">    % than some threshold. If we considered all gradients greater than </span><br/>               <span style="color: #A0A0A0"> 408</span> <span style="color: #228B22; background: #FFFFFF;">    % zero then it might be possible to add a constraint which would lead to</span><br/>               <span style="color: #A0A0A0"> 409</span> <span style="color: #228B22; background: #FFFFFF;">    % a singular (rank deficient) working set. The gradient (GSD) of such</span><br/>               <span style="color: #A0A0A0"> 410</span> <span style="color: #228B22; background: #FFFFFF;">    % a constraint in the direction of search would be very close to zero.</span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 411</span> <span style="color: #000000; background: #FFFFFF;">    indf = find((GSD &gt; errnorm * norm(SD))  &amp;  ~aix); </span><br/>               <span style="color: #A0A0A0"> 412</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 413</span> <span style="color: #000000; background: #FFFFFF;">    if isempty(indf) % No constraints to hit </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 414</span> <span style="color: #000000; background: #FFFFFF;">        STEPMIN=1e16; </span><br/><a name="Line415"></a>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 415</span> <span style="color: #000000; background: #FFFFFF;">        dist=[]; ind2=[]; ind=[]; </span><br/>       <span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 416</span> <span style="color: #228B22; background: #FFFFFF;">    else % Find distance to the nearest constraint </span><br/>       <span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 417</span> <span style="color: #000000; background: #FFFFFF;">        dist = abs(cstr(indf)./GSD(indf)); </span><br/><a name="Line418"></a><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 418</span> <span style="color: #000000; background: #FFFFFF;">        [STEPMIN,ind2] =  min(dist); </span><br/><a name="Line419"></a><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 419</span> <span style="color: #000000; background: #FFFFFF;">        ind2 = find(dist == STEPMIN); </span><br/>               <span style="color: #A0A0A0"> 420</span> <span style="color: #228B22; background: #FFFFFF;">        % Bland's rule for anti-cycling: if there is more than one </span><br/>               <span style="color: #A0A0A0"> 421</span> <span style="color: #228B22; background: #FFFFFF;">        % blocking constraint then add the one with the smallest index.</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 422</span> <span style="color: #000000; background: #FFFFFF;">        ind=indf(min(ind2)); </span><br/>               <span style="color: #A0A0A0"> 423</span> <span style="color: #228B22; background: #FFFFFF;">        % Non-cycling rule:</span><br/>               <span style="color: #A0A0A0"> 424</span> <span style="color: #228B22; background: #FFFFFF;">        % ind = indf(ind2(1));</span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 425</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 426</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 427</span> <span style="color: #228B22; background: #FFFFFF;">    %----------------Update X---------------------</span><br/>               <span style="color: #A0A0A0"> 428</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 429</span> <span style="color: #228B22; background: #FFFFFF;">    % Assume we do not delete a constraint</span><br/>       <span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 430</span> <span style="color: #000000; background: #FFFFFF;">    delete_constr = 0;    </span><br/>               <span style="color: #A0A0A0"> 431</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 432</span> <span style="color: #000000; background: #FFFFFF;">    if ~isempty(indf) &amp;&amp; isfinite(STEPMIN) % Hit a constraint </span><br/>       <span style="color: #0000FF">    766 </span><span style="color: #000000; font-weight: bold"> 433</span> <span style="color: #000000; background: #FFFFFF;">        if strcmp(dirType, NewtonStep) </span><br/>               <span style="color: #A0A0A0"> 434</span> <span style="color: #228B22; background: #FFFFFF;">            % Newton step and hit a constraint: LLS or is_qp</span><br/>       <span style="color: #0000FF">     99 </span><span style="color: #000000; font-weight: bold"> 435</span> <span style="color: #000000; background: #FFFFFF;">            if STEPMIN &gt; 1  % Overstepped minimum; reset STEPMIN </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 436</span> <span style="color: #000000; background: #FFFFFF;">                STEPMIN = 1; </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 437</span> <span style="color: #000000; background: #FFFFFF;">                delete_constr = 1; </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 438</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>       <span style="color: #0000FF">     99 </span><span style="color: #000000; font-weight: bold"> 439</span> <span style="color: #000000; background: #FFFFFF;">            X = X+STEPMIN*SD; </span><br/>       <span style="color: #0000FF">    667 </span><span style="color: #000000; font-weight: bold"> 440</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/>               <span style="color: #A0A0A0"> 441</span> <span style="color: #228B22; background: #FFFFFF;">            % Not a Newton step and hit a constraint: is_qp or LLS or maybe lp</span><br/>       <span style="color: #0000FF">    667 </span><span style="color: #000000; font-weight: bold"> 442</span> <span style="color: #000000; background: #FFFFFF;">            X = X+STEPMIN*SD;   </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    667 </span><span style="color: #000000; font-weight: bold"> 443</span> <span style="color: #000000; background: #FFFFFF;">        end               </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 444</span> <span style="color: #228B22; background: #FFFFFF;">    else %  isempty(indf) | ~isfinite(STEPMIN) </span><br/>               <span style="color: #A0A0A0"> 445</span> <span style="color: #228B22; background: #FFFFFF;">        % did not hit a constraint</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 446</span> <span style="color: #000000; background: #FFFFFF;">        if strcmp(dirType, NewtonStep) </span><br/>               <span style="color: #A0A0A0"> 447</span> <span style="color: #228B22; background: #FFFFFF;">            % Newton step and no constraint hit: LLS or maybe is_qp</span><br/>               <span style="color: #A0A0A0"> 448</span> <span style="color: #A0A0A0; background: #FFFFFF;">            STEPMIN = 1;   % Exact distance to the solution. Now delete constr.</span><br/>               <span style="color: #A0A0A0"> 449</span> <span style="color: #A0A0A0; background: #FFFFFF;">            X = X + SD;</span><br/>               <span style="color: #A0A0A0"> 450</span> <span style="color: #A0A0A0; background: #FFFFFF;">            delete_constr = 1;</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 451</span> <span style="color: #228B22; background: #FFFFFF;">        else % Not a Newton step: is_qp or lp or LLS </span><br/>               <span style="color: #A0A0A0"> 452</span> <span style="color: #228B22; background: #FFFFFF;">            </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 453</span> <span style="color: #000000; background: #FFFFFF;">            if (~is_qp &amp;&amp; ~LLS) || strcmp(dirType, NegCurv) % LP or neg def (implies is_qp) </span><br/>               <span style="color: #A0A0A0"> 454</span> <span style="color: #228B22; background: #FFFFFF;">                % neg def -- unbounded</span><br/>               <span style="color: #A0A0A0"> 455</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if norm(SD) &gt; errnorm</span><br/>               <span style="color: #A0A0A0"> 456</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if normalize &lt; 0</span><br/>               <span style="color: #A0A0A0"> 457</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        STEPMIN=abs((X(numberOfVariables)+1e-5)/(SD(numberOfVariables)+eps));</span><br/>               <span style="color: #A0A0A0"> 458</span> <span style="color: #228B22; background: #FFFFFF;">                    else </span><br/>               <span style="color: #A0A0A0"> 459</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        STEPMIN = 1e16;</span><br/>               <span style="color: #A0A0A0"> 460</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 461</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    X=X+STEPMIN*SD;</span><br/>               <span style="color: #A0A0A0"> 462</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    how='unbounded'; </span><br/>               <span style="color: #A0A0A0"> 463</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    exitflag = -3;</span><br/>               <span style="color: #A0A0A0"> 464</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    msg = sprintf(['Exiting: the solution is unbounded and at infinity;\n' ...</span><br/>               <span style="color: #A0A0A0"> 465</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                          ' the constraints are not restrictive enough.']);</span><br/>               <span style="color: #A0A0A0"> 466</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 467</span> <span style="color: #A0A0A0; background: #FFFFFF;">                      disp(msg)</span><br/>               <span style="color: #A0A0A0"> 468</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 469</span> <span style="color: #228B22; background: #FFFFFF;">                else % norm(SD) &lt;= errnorm</span><br/>               <span style="color: #A0A0A0"> 470</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    how = 'ill posed';</span><br/>               <span style="color: #A0A0A0"> 471</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    exitflag = -7;</span><br/>               <span style="color: #A0A0A0"> 472</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    msg = ...</span><br/>               <span style="color: #A0A0A0"> 473</span> <span style="color: #A0A0A0; background: #FFFFFF;">                      sprintf(['Exiting: magnitude of search direction is close to zero; no further\n' ... </span><br/>               <span style="color: #A0A0A0"> 474</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                ' progress can be made. The problem may be ill-posed or badly conditioned.']);</span><br/>               <span style="color: #A0A0A0"> 475</span> <span style="color: #A0A0A0; background: #FFFFFF;">                      if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 476</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        disp(msg)</span><br/>               <span style="color: #A0A0A0"> 477</span> <span style="color: #A0A0A0; background: #FFFFFF;">                      end</span><br/>               <span style="color: #A0A0A0"> 478</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 479</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 480</span> <span style="color: #A0A0A0; background: #FFFFFF;">                output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 481</span> <span style="color: #A0A0A0; background: #FFFFFF;">                return</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 482</span> <span style="color: #228B22; background: #FFFFFF;">            else % singular: solve compatible system for a solution: is_qp or LLS </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 483</span> <span style="color: #000000; background: #FFFFFF;">                if is_qp </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 484</span> <span style="color: #000000; background: #FFFFFF;">                    projH = Z'*H*Z;  </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 485</span> <span style="color: #000000; background: #FFFFFF;">                    Zgf = Z'*gf; </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 486</span> <span style="color: #000000; background: #FFFFFF;">                    projSD = <a href="file41.html">pinv</a>(projH)*(-Zgf); </span><br/>               <span style="color: #A0A0A0"> 487</span> <span style="color: #228B22; background: #FFFFFF;">                else % LLS</span><br/>               <span style="color: #A0A0A0"> 488</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    projH = HZ'*HZ; </span><br/>               <span style="color: #A0A0A0"> 489</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    Zgf = Z'*gf;</span><br/>               <span style="color: #A0A0A0"> 490</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    projSD = pinv(projH)*(-Zgf);</span><br/>               <span style="color: #A0A0A0"> 491</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 492</span> <span style="color: #228B22; background: #FFFFFF;">                </span><br/>               <span style="color: #A0A0A0"> 493</span> <span style="color: #228B22; background: #FFFFFF;">                % Check if compatible</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 494</span> <span style="color: #000000; background: #FFFFFF;">                if norm(projH*projSD+Zgf) &gt; 10*eps*(norm(projH) + norm(Zgf)) </span><br/>               <span style="color: #A0A0A0"> 495</span> <span style="color: #228B22; background: #FFFFFF;">                    % system is incompatible --&gt; it's a "chute": use SD from compdir</span><br/>               <span style="color: #A0A0A0"> 496</span> <span style="color: #228B22; background: #FFFFFF;">                    % unbounded in SD direction</span><br/>               <span style="color: #A0A0A0"> 497</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if norm(SD) &gt; errnorm</span><br/>               <span style="color: #A0A0A0"> 498</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if normalize &lt; 0</span><br/>               <span style="color: #A0A0A0"> 499</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            STEPMIN=abs((X(numberOfVariables)+1e-5)/(SD(numberOfVariables)+eps));</span><br/>               <span style="color: #A0A0A0"> 500</span> <span style="color: #228B22; background: #FFFFFF;">                        else </span><br/>               <span style="color: #A0A0A0"> 501</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            STEPMIN = 1e16;</span><br/>               <span style="color: #A0A0A0"> 502</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 503</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        X=X+STEPMIN*SD;</span><br/>               <span style="color: #A0A0A0"> 504</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        how='unbounded'; </span><br/>               <span style="color: #A0A0A0"> 505</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        exitflag = -3;</span><br/>               <span style="color: #A0A0A0"> 506</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        msg = sprintf(['Exiting: the solution is unbounded and at infinity;\n' ...</span><br/>               <span style="color: #A0A0A0"> 507</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                          ' the constraints are not restrictive enough.']);</span><br/>               <span style="color: #A0A0A0"> 508</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 509</span> <span style="color: #A0A0A0; background: #FFFFFF;">                          disp(msg)</span><br/>               <span style="color: #A0A0A0"> 510</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end</span><br/>               <span style="color: #A0A0A0"> 511</span> <span style="color: #228B22; background: #FFFFFF;">                    else % norm(SD) &lt;= errnorm</span><br/>               <span style="color: #A0A0A0"> 512</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        how = 'ill posed';</span><br/>               <span style="color: #A0A0A0"> 513</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        exitflag = -7;</span><br/>               <span style="color: #A0A0A0"> 514</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        msg = ...</span><br/>               <span style="color: #A0A0A0"> 515</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            sprintf(['Exiting: magnitude of search direction is close to zero; no further\n' ... </span><br/>               <span style="color: #A0A0A0"> 516</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                     ' progress can be made. The problem may be ill-posed or badly conditioned.']);</span><br/>               <span style="color: #A0A0A0"> 517</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 518</span> <span style="color: #A0A0A0; background: #FFFFFF;">                          disp(msg)</span><br/>               <span style="color: #A0A0A0"> 519</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        end                        </span><br/>               <span style="color: #A0A0A0"> 520</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 521</span> <span style="color: #228B22; background: #FFFFFF;">                    </span><br/>               <span style="color: #A0A0A0"> 522</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 523</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 524</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    return</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 525</span> <span style="color: #228B22; background: #FFFFFF;">                else % Convex -- move to the minimum (compatible system) </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 526</span> <span style="color: #000000; background: #FFFFFF;">                    SD = Z*projSD; </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 527</span> <span style="color: #000000; background: #FFFFFF;">                    if gf'*SD &gt; 0 </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 528</span> <span style="color: #000000; background: #FFFFFF;">                        SD = -SD; </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 529</span> <span style="color: #000000; background: #FFFFFF;">                    end </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 530</span> <span style="color: #000000; background: #FFFFFF;">                    dirType = 'singular'; </span><br/>               <span style="color: #A0A0A0"> 531</span> <span style="color: #228B22; background: #FFFFFF;">                    % First check if constraint is violated.</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 532</span> <span style="color: #000000; background: #FFFFFF;">                    GSD=A*SD; </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 533</span> <span style="color: #000000; background: #FFFFFF;">                    indf = find((GSD &gt; errnorm * norm(SD))  &amp;  ~aix); </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 534</span> <span style="color: #000000; background: #FFFFFF;">                    if isempty(indf) % No constraints to hit </span><br/>               <span style="color: #A0A0A0"> 535</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        STEPMIN=1;</span><br/>               <span style="color: #A0A0A0"> 536</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        delete_constr = 1;</span><br/><a name="Line537"></a>               <span style="color: #A0A0A0"> 537</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        dist=[]; ind2=[]; ind=[];</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 538</span> <span style="color: #228B22; background: #FFFFFF;">                    else % Find distance to the nearest constraint </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 539</span> <span style="color: #000000; background: #FFFFFF;">                        dist = abs(cstr(indf)./GSD(indf)); </span><br/><a name="Line540"></a>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 540</span> <span style="color: #000000; background: #FFFFFF;">                        [STEPMIN,ind2] =  min(dist); </span><br/><a name="Line541"></a>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 541</span> <span style="color: #000000; background: #FFFFFF;">                        ind2 = find(dist == STEPMIN); </span><br/>               <span style="color: #A0A0A0"> 542</span> <span style="color: #228B22; background: #FFFFFF;">                        % Bland's rule for anti-cycling: if there is more than one </span><br/>               <span style="color: #A0A0A0"> 543</span> <span style="color: #228B22; background: #FFFFFF;">                        % blocking constraint then add the one with the smallest index.</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 544</span> <span style="color: #000000; background: #FFFFFF;">                        ind=indf(min(ind2)); </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 545</span> <span style="color: #000000; background: #FFFFFF;">                    end </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 546</span> <span style="color: #000000; background: #FFFFFF;">                    if STEPMIN &gt; 1  % Overstepped minimum; reset STEPMIN </span><br/>               <span style="color: #A0A0A0"> 547</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        STEPMIN = 1;</span><br/>               <span style="color: #A0A0A0"> 548</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        delete_constr = 1;</span><br/>               <span style="color: #A0A0A0"> 549</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 550</span> <span style="color: #000000; background: #FFFFFF;">                    X = X + STEPMIN*SD;  </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 551</span> <span style="color: #000000; background: #FFFFFF;">                end </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 552</span> <span style="color: #000000; background: #FFFFFF;">            end % if ~is_qp | smallRealEig &lt; -eps </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 553</span> <span style="color: #000000; background: #FFFFFF;">        end % if strcmp(dirType, NewtonStep) </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 554</span> <span style="color: #000000; background: #FFFFFF;">    end % if ~isempty(indf)&amp; isfinite(STEPMIN) % Hit a constraint </span><br/>               <span style="color: #A0A0A0"> 555</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 556</span> <span style="color: #228B22; background: #FFFFFF;">    % Calculate gradient w.r.t objective at this point</span><br/>       <span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 557</span> <span style="color: #000000; background: #FFFFFF;">    if is_qp </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    672 </span><span style="color: #000000; font-weight: bold"> 558</span> <span style="color: #000000; background: #FFFFFF;">        gf=H*X+f; </span><br/>       <span style="color: #0000FF">    116 </span><span style="color: #000000; font-weight: bold"> 559</span> <span style="color: #000000; background: #FFFFFF;">    elseif LLS % LLS </span><br/>               <span style="color: #A0A0A0"> 560</span> <span style="color: #A0A0A0; background: #FFFFFF;">        gf=H'*(H*X-f);</span><br/>               <span style="color: #A0A0A0"> 561</span> <span style="color: #228B22; background: #FFFFFF;">        % else gf=f still true.</span><br/>               <span style="color: #A0A0A0"> 562</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 563</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 564</span> <span style="color: #228B22; background: #FFFFFF;">    %----Check if reached minimum in current subspace-----</span><br/>               <span style="color: #A0A0A0"> 565</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    788 </span><span style="color: #000000; font-weight: bold"> 566</span> <span style="color: #000000; background: #FFFFFF;">    if delete_constr </span><br/>               <span style="color: #A0A0A0"> 567</span> <span style="color: #228B22; background: #FFFFFF;">        % Note: only reach here if a minimum in the current subspace found</span><br/>               <span style="color: #A0A0A0"> 568</span> <span style="color: #228B22; background: #FFFFFF;">        %       LP's do not enter here.</span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 569</span> <span style="color: #000000; background: #FFFFFF;">        if ACTCNT&gt;0 </span><br/>               <span style="color: #A0A0A0"> 570</span> <span style="color: #228B22; background: #FFFFFF;">            % Disable the warnings about conditioning for singular and</span><br/>               <span style="color: #A0A0A0"> 571</span> <span style="color: #228B22; background: #FFFFFF;">            % nearly singular matrices</span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 572</span> <span style="color: #000000; background: #FFFFFF;">            warningstate1 = warning('off', 'MATLAB:nearlySingularMatrix'); </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 573</span> <span style="color: #000000; background: #FFFFFF;">            warningstate2 = warning('off', 'MATLAB:singularMatrix'); </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 574</span> <span style="color: #000000; background: #FFFFFF;">            if is_qp </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 575</span> <span style="color: #000000; background: #FFFFFF;">                rlambda = -R\(Q'*gf); </span><br/>               <span style="color: #A0A0A0"> 576</span> <span style="color: #A0A0A0; background: #FFFFFF;">            elseif LLS</span><br/>               <span style="color: #A0A0A0"> 577</span> <span style="color: #A0A0A0; background: #FFFFFF;">                rlambda = -R\(Q'*gf);</span><br/>               <span style="color: #A0A0A0"> 578</span> <span style="color: #228B22; background: #FFFFFF;">                % else: lp does not reach this point</span><br/>               <span style="color: #A0A0A0"> 579</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 580</span> <span style="color: #000000; background: #FFFFFF;">            actlambda = rlambda; </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 581</span> <span style="color: #000000; background: #FFFFFF;">            actlambda(eqix) = abs(rlambda(eqix)); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 582</span> <span style="color: #000000; background: #FFFFFF;">            indlam = find(actlambda &lt; 0); </span><br/><a name="Line583"></a>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 583</span> <span style="color: #000000; background: #FFFFFF;">            if (~length(indlam))  </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 584</span> <span style="color: #000000; background: #FFFFFF;">                lambda(indepInd(ACTIND)) = normf * (rlambda./normA(ACTIND)); </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 585</span> <span style="color: #000000; background: #FFFFFF;">                ACTIND = indepInd(ACTIND); </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 586</span> <span style="color: #000000; background: #FFFFFF;">                output.iterations = iterations; </span><br/>               <span style="color: #A0A0A0"> 587</span> <span style="color: #228B22; background: #FFFFFF;">                % Restore the warning states to their original settings</span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 588</span> <span style="color: #000000; background: #FFFFFF;">                warning(warningstate1) </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 589</span> <span style="color: #000000; background: #FFFFFF;">                warning(warningstate2) </span><br/>       <span style="color: #0000FF">     38 </span><span style="color: #000000; font-weight: bold"> 590</span> <span style="color: #000000; background: #FFFFFF;">                return </span><br/>               <span style="color: #A0A0A0"> 591</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 592</span> <span style="color: #228B22; background: #FFFFFF;">            % Remove constraint</span><br/>               <span style="color: #A0A0A0"> 593</span> <span style="color: #A0A0A0; background: #FFFFFF;">            lind = find(ACTIND == min(ACTIND(indlam)));</span><br/>               <span style="color: #A0A0A0"> 594</span> <span style="color: #A0A0A0; background: #FFFFFF;">            lind = lind(1);</span><br/>               <span style="color: #A0A0A0"> 595</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ACTSET(lind,:) = [];</span><br/>               <span style="color: #A0A0A0"> 596</span> <span style="color: #A0A0A0; background: #FFFFFF;">            aix(ACTIND(lind)) = 0;</span><br/>               <span style="color: #A0A0A0"> 597</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [Q,R]=qrdelete(Q,R,lind);</span><br/>               <span style="color: #A0A0A0"> 598</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ACTIND(lind) = [];</span><br/>               <span style="color: #A0A0A0"> 599</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ACTCNT = length(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 600</span> <span style="color: #A0A0A0; background: #FFFFFF;">            simplex_iter = 0;</span><br/>               <span style="color: #A0A0A0"> 601</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ind = 0;</span><br/>               <span style="color: #A0A0A0"> 602</span> <span style="color: #228B22; background: #FFFFFF;">            % Restore the warning states to their original settings</span><br/>               <span style="color: #A0A0A0"> 603</span> <span style="color: #A0A0A0; background: #FFFFFF;">            warning(warningstate1)</span><br/>               <span style="color: #A0A0A0"> 604</span> <span style="color: #A0A0A0; background: #FFFFFF;">            warning(warningstate2)</span><br/>               <span style="color: #A0A0A0"> 605</span> <span style="color: #228B22; background: #FFFFFF;">        else % ACTCNT == 0</span><br/>               <span style="color: #A0A0A0"> 606</span> <span style="color: #A0A0A0; background: #FFFFFF;">            output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 607</span> <span style="color: #A0A0A0; background: #FFFFFF;">            return</span><br/>               <span style="color: #A0A0A0"> 608</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/><a name="Line609"></a>               <span style="color: #A0A0A0"> 609</span> <span style="color: #A0A0A0; background: #FFFFFF;">        delete_constr = 0;</span><br/>               <span style="color: #A0A0A0"> 610</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 611</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 612</span> <span style="color: #228B22; background: #FFFFFF;">    % If we are in the Phase-1 procedure check if the slack variable</span><br/>               <span style="color: #A0A0A0"> 613</span> <span style="color: #228B22; background: #FFFFFF;">    % is zero indicating we have found a feasible starting point.</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    750 </span><span style="color: #000000; font-weight: bold"> 614</span> <span style="color: #000000; background: #FFFFFF;">    if normalize &lt; 0 </span><br/>       <span style="color: #0000FF">    116 </span><span style="color: #000000; font-weight: bold"> 615</span> <span style="color: #000000; background: #FFFFFF;">        if X(numberOfVariables,1) &lt; eps </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 616</span> <span style="color: #000000; background: #FFFFFF;">            ACTIND = indepInd(ACTIND); </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 617</span> <span style="color: #000000; background: #FFFFFF;">            output.iterations = iterations; </span><br/>       <span style="color: #0000FF">     33 </span><span style="color: #000000; font-weight: bold"> 618</span> <span style="color: #000000; background: #FFFFFF;">            return; </span><br/>               <span style="color: #A0A0A0"> 619</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 620</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 621</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>               <span style="color: #A0A0A0"> 622</span> <span style="color: #228B22; background: #FFFFFF;">    % Update constraints</span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 623</span> <span style="color: #000000; background: #FFFFFF;">    cstr = A*X-B; </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 624</span> <span style="color: #000000; background: #FFFFFF;">    cstr(eqix) = abs(cstr(eqix)); </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 625</span> <span style="color: #000000; background: #FFF0F0;">    if max(cstr) &gt; 1e5 * errnorm </span><br/>               <span style="color: #A0A0A0"> 626</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if max(cstr) &gt; norm(X) * errnorm</span><br/>               <span style="color: #A0A0A0"> 627</span> <span style="color: #228B22; background: #FFFFFF;">            % Display a message to the command window</span><br/>               <span style="color: #A0A0A0"> 628</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if exitflag == 1 &amp;&amp; verbosity &gt; 0 &amp;&amp; ~illCondWarningAlreadyDisplayed</span><br/>               <span style="color: #A0A0A0"> 629</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warning('optim:qpsub:SolUnreliable', ...</span><br/>               <span style="color: #A0A0A0"> 630</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    'The problem is badly conditioned; the solution may not be reliable.')</span><br/>               <span style="color: #A0A0A0"> 631</span> <span style="color: #A0A0A0; background: #FFFFFF;">                illCondWarningAlreadyDisplayed = true; % do not display warning multiple times</span><br/>               <span style="color: #A0A0A0"> 632</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 633</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 634</span> <span style="color: #A0A0A0; background: #FFFFFF;">        how='unreliable';</span><br/>               <span style="color: #A0A0A0"> 635</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 636</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 637</span> <span style="color: #228B22; background: #FFFFFF;">    %----Add blocking constraint to working set----</span><br/>               <span style="color: #A0A0A0"> 638</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 639</span> <span style="color: #000000; background: #FFFFFF;">    if ind % Hit a constraint </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 640</span> <span style="color: #000000; background: #FFFFFF;">        aix(ind)=1; </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 641</span> <span style="color: #000000; background: #FFFFFF;">        CIND = length(ACTIND) + 1; </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 642</span> <span style="color: #000000; background: #FFFFFF;">        ACTSET(CIND,:)=A(ind,:); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 643</span> <span style="color: #000000; background: #FFFFFF;">        ACTIND(CIND)=ind; </span><br/><a name="Line644"></a>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 644</span> <span style="color: #000000; background: #FFFFFF;">        [m,n]=size(ACTSET); </span><br/><span style="color: #FF0000">  0.32 </span><span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 645</span> <a name="Line645"></a><span style="color: #000000; background: #FF8080;">        [Q,R] = <a href="file36.html">qrinsert</a>(Q,R,CIND,A(ind,:)'); </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 646</span> <span style="color: #000000; background: #FFFFFF;">        ACTCNT = length(ACTIND); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 647</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">    717 </span><span style="color: #000000; font-weight: bold"> 648</span> <span style="color: #000000; background: #FFFFFF;">    if ~simplex_iter </span><br/>               <span style="color: #A0A0A0"> 649</span> <span style="color: #228B22; background: #FFFFFF;">        % Z = null(ACTSET);</span><br/>       <span style="color: #0000FF">    534 </span><span style="color: #000000; font-weight: bold"> 650</span> <span style="color: #000000; background: #FFFFFF;">        [m,n]=size(ACTSET); </span><br/>       <span style="color: #0000FF">    534 </span><span style="color: #000000; font-weight: bold"> 651</span> <span style="color: #000000; background: #FFFFFF;">        Z = Q(:,m+1:n); </span><br/>       <span style="color: #0000FF">    534 </span><span style="color: #000000; font-weight: bold"> 652</span> <span style="color: #000000; background: #FFFFFF;">        if ACTCNT == numberOfVariables - 1, simplex_iter = 1; end </span><br/>       <span style="color: #0000FF">    534 </span><span style="color: #000000; font-weight: bold"> 653</span> <span style="color: #000000; background: #FFFFFF;">        oldind = 0;  </span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 654</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>               <span style="color: #A0A0A0"> 655</span> <span style="color: #228B22; background: #FFFFFF;">        % Disable the warnings about conditioning for singular and</span><br/>               <span style="color: #A0A0A0"> 656</span> <span style="color: #228B22; background: #FFFFFF;">        % nearly singular matrices</span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 657</span> <span style="color: #000000; background: #FFFFFF;">        warningstate1 = warning('off', 'MATLAB:nearlySingularMatrix'); </span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 658</span> <span style="color: #000000; background: #FFFFFF;">        warningstate2 = warning('off', 'MATLAB:singularMatrix'); </span><br/>               <span style="color: #A0A0A0"> 659</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 660</span> <span style="color: #228B22; background: #FFFFFF;">        %---If Simplex Alg. choose leaving constraint---</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 661</span> <span style="color: #000000; background: #FFFFFF;">        rlambda = -R\(Q'*gf); </span><br/>               <span style="color: #A0A0A0"> 662</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 663</span> <span style="color: #228B22; background: #FFFFFF;">        % Restore the warning states to their original settings</span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 664</span> <span style="color: #000000; background: #FFFFFF;">        warning(warningstate1) </span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 665</span> <span style="color: #000000; background: #FFFFFF;">        warning(warningstate2) </span><br/>               <span style="color: #A0A0A0"> 666</span> <span style="color: #228B22; background: #FFFFFF;">       </span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 667</span> <span style="color: #000000; background: #FFFFFF;">        if isinf(rlambda(1)) &amp;&amp; rlambda(1) &lt; 0  </span><br/>               <span style="color: #A0A0A0"> 668</span> <span style="color: #A0A0A0; background: #FFFFFF;">            fprintf('         Working set is singular; results may still be reliable.\n');</span><br/>               <span style="color: #A0A0A0"> 669</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [m,n] = size(ACTSET);</span><br/>               <span style="color: #A0A0A0"> 670</span> <span style="color: #A0A0A0; background: #FFFFFF;">            rlambda = -(ACTSET + sqrt(eps)*randn(m,n))'\gf;</span><br/>               <span style="color: #A0A0A0"> 671</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 672</span> <span style="color: #000000; background: #FFFFFF;">        actlambda = rlambda; </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 673</span> <span style="color: #000000; background: #FFFFFF;">        actlambda(eqix)=abs(actlambda(eqix)); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 674</span> <span style="color: #000000; background: #FFFFFF;">        indlam = find(actlambda&lt;0); </span><br/><a name="Line675"></a>       <span style="color: #0000FF">    183 </span><span style="color: #000000; font-weight: bold"> 675</span> <span style="color: #000000; background: #FFFFFF;">        if length(indlam) </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 676</span> <span style="color: #000000; background: #FFFFFF;">            if STEPMIN &gt; errnorm </span><br/>               <span style="color: #A0A0A0"> 677</span> <span style="color: #228B22; background: #FFFFFF;">                % If there is no chance of cycling then pick the constraint </span><br/>               <span style="color: #A0A0A0"> 678</span> <span style="color: #228B22; background: #FFFFFF;">                % which causes the biggest reduction in the cost function. </span><br/>               <span style="color: #A0A0A0"> 679</span> <span style="color: #228B22; background: #FFFFFF;">                % i.e the constraint with the most negative Lagrangian </span><br/>               <span style="color: #A0A0A0"> 680</span> <span style="color: #228B22; background: #FFFFFF;">                % multiplier. Since the constraints are normalized this may </span><br/>               <span style="color: #A0A0A0"> 681</span> <span style="color: #228B22; background: #FFFFFF;">                % result in less iterations.</span><br/>       <span style="color: #0000FF">    137 </span><span style="color: #000000; font-weight: bold"> 682</span> <span style="color: #000000; background: #FFFFFF;">                [minl,lind] = min(actlambda); </span><br/>       <span style="color: #0000FF">      7 </span><span style="color: #000000; font-weight: bold"> 683</span> <span style="color: #228B22; background: #FFFFFF;">            else </span><br/>               <span style="color: #A0A0A0"> 684</span> <span style="color: #228B22; background: #FFFFFF;">                % Bland's rule for anti-cycling: if there is more than one </span><br/>               <span style="color: #A0A0A0"> 685</span> <span style="color: #228B22; background: #FFFFFF;">                % negative Lagrangian multiplier then delete the constraint</span><br/>               <span style="color: #A0A0A0"> 686</span> <span style="color: #228B22; background: #FFFFFF;">                % with the smallest index in the active set.</span><br/>       <span style="color: #0000FF">      7 </span><span style="color: #000000; font-weight: bold"> 687</span> <span style="color: #000000; background: #FFFFFF;">                lind = find(ACTIND == min(ACTIND(indlam))); </span><br/>       <span style="color: #0000FF">      7 </span><span style="color: #000000; font-weight: bold"> 688</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 689</span> <span style="color: #000000; background: #FFFFFF;">            lind = lind(1); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 690</span> <span style="color: #000000; background: #FFFFFF;">            ACTSET(lind,:) = []; </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 691</span> <span style="color: #000000; background: #FFFFFF;">            aix(ACTIND(lind)) = 0; </span><br/><span style="color: #FF0000">  0.09 </span><span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 692</span> <a name="Line692"></a><span style="color: #000000; background: #FFE2E2;">            [Q,R]=<a href="file37.html">qrdelete</a>(Q,R,lind); </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 693</span> <span style="color: #000000; background: #FFFFFF;">            Z = Q(:,numberOfVariables); </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 694</span> <span style="color: #000000; background: #FFFFFF;">            oldind = ACTIND(lind); </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 695</span> <span style="color: #000000; background: #FFFFFF;">            ACTIND(lind) = []; </span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 696</span> <span style="color: #000000; background: #FFFFFF;">            ACTCNT = length(ACTIND); </span><br/>       <span style="color: #0000FF">     39 </span><span style="color: #000000; font-weight: bold"> 697</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/>       <span style="color: #0000FF">     39 </span><span style="color: #000000; font-weight: bold"> 698</span> <span style="color: #000000; background: #FFFFFF;">            lambda(indepInd(ACTIND))= normf * (rlambda./normA(ACTIND)); </span><br/>       <span style="color: #0000FF">     39 </span><span style="color: #000000; font-weight: bold"> 699</span> <span style="color: #000000; background: #FFFFFF;">            ACTIND = indepInd(ACTIND); </span><br/>       <span style="color: #0000FF">     39 </span><span style="color: #000000; font-weight: bold"> 700</span> <span style="color: #000000; background: #FFFFFF;">            output.iterations = iterations; </span><br/>       <span style="color: #0000FF">     39 </span><span style="color: #000000; font-weight: bold"> 701</span> <span style="color: #000000; background: #FFFFFF;">            return </span><br/>               <span style="color: #A0A0A0"> 702</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">    144 </span><span style="color: #000000; font-weight: bold"> 703</span> <span style="color: #000000; background: #FFFFFF;">    end %if ACTCNT&lt;numberOfVariables </span><br/>               <span style="color: #A0A0A0"> 704</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 705</span> <span style="color: #228B22; background: #FFFFFF;">    %----------Compute Search Direction-------------      </span><br/>               <span style="color: #A0A0A0"> 706</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 707</span> <span style="color: #000000; background: #FFFFFF;">    if (is_qp) </span><br/>       <span style="color: #0000FF">    595 </span><span style="color: #000000; font-weight: bold"> 708</span> <span style="color: #000000; background: #FFFFFF;">        Zgf = Z'*gf;  </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    595 </span><span style="color: #000000; font-weight: bold"> 709</span> <span style="color: #000000; background: #FFFFFF;">        if ~isempty(Zgf) &amp;&amp; (norm(Zgf) &lt; 1e-15) </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 710</span> <span style="color: #000000; background: #FFFFFF;">            SD = zeros(numberOfVariables,1);  </span><br/>       <span style="color: #0000FF">     22 </span><span style="color: #000000; font-weight: bold"> 711</span> <span style="color: #000000; background: #FFFFFF;">            dirType = ZeroStep; </span><br/>       <span style="color: #0000FF">    573 </span><span style="color: #000000; font-weight: bold"> 712</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/><span style="color: #FF0000">  0.17 </span><span style="color: #0000FF">    573 </span><span style="color: #000000; font-weight: bold"> 713</span> <a name="Line713"></a><span style="color: #000000; background: #FFB8B8;">            [SD, dirType] = <a href="file39.html">compdir</a>(Z,H,gf,numberOfVariables,f); </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">    573 </span><span style="color: #000000; font-weight: bold"> 714</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 715</span> <span style="color: #000000; background: #FFFFFF;">    elseif (LLS) </span><br/>               <span style="color: #A0A0A0"> 716</span> <span style="color: #A0A0A0; background: #FFFFFF;">        Zgf = Z'*gf;</span><br/>               <span style="color: #A0A0A0"> 717</span> <span style="color: #A0A0A0; background: #FFFFFF;">        HZ = H*Z;</span><br/>               <span style="color: #A0A0A0"> 718</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if (norm(Zgf) &lt; 1e-15)</span><br/>               <span style="color: #A0A0A0"> 719</span> <span style="color: #A0A0A0; background: #FFFFFF;">            SD = zeros(numberOfVariables,1);</span><br/>               <span style="color: #A0A0A0"> 720</span> <span style="color: #A0A0A0; background: #FFFFFF;">            dirType = ZeroStep;</span><br/>               <span style="color: #A0A0A0"> 721</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 722</span> <span style="color: #A0A0A0; background: #FFFFFF;">            HXf=H*X-f;</span><br/>               <span style="color: #A0A0A0"> 723</span> <span style="color: #A0A0A0; background: #FFFFFF;">            gf=H'*(HXf);</span><br/>               <span style="color: #A0A0A0"> 724</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [mm,nn]=size(HZ);</span><br/>               <span style="color: #A0A0A0"> 725</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if mm &gt;= nn</span><br/>               <span style="color: #A0A0A0"> 726</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [QHZ, RHZ] =  qr(HZ,0);</span><br/>               <span style="color: #A0A0A0"> 727</span> <span style="color: #A0A0A0; background: #FFFFFF;">                Pd = QHZ'*HXf;</span><br/>               <span style="color: #A0A0A0"> 728</span> <span style="color: #228B22; background: #FFFFFF;">                % SD = - Z*(RHZ(1:nn, 1:nn) \ Pd(1:nn,:));</span><br/>               <span style="color: #A0A0A0"> 729</span> <span style="color: #228B22; background: #FFFFFF;">                % Now need to check which is dependent</span><br/>               <span style="color: #A0A0A0"> 730</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if min(size(RHZ))==1 % Make sure RHZ isn't a vector</span><br/>               <span style="color: #A0A0A0"> 731</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    depInd = find( abs(RHZ(1,1)) &lt; tolDep);</span><br/>               <span style="color: #A0A0A0"> 732</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 733</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    depInd = find( abs(diag(RHZ)) &lt; tolDep );</span><br/>               <span style="color: #A0A0A0"> 734</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end  </span><br/>               <span style="color: #A0A0A0"> 735</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 736</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if mm &gt;= nn &amp;&amp; isempty(depInd) % Newton step</span><br/>               <span style="color: #A0A0A0"> 737</span> <span style="color: #228B22; background: #FFFFFF;">                % Disable the warnings about conditioning for singular and</span><br/>               <span style="color: #A0A0A0"> 738</span> <span style="color: #228B22; background: #FFFFFF;">                % nearly singular matrices</span><br/>               <span style="color: #A0A0A0"> 739</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warningstate1 = warning('off', 'MATLAB:nearlySingularMatrix');</span><br/>               <span style="color: #A0A0A0"> 740</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warningstate2 = warning('off', 'MATLAB:singularMatrix');</span><br/>               <span style="color: #A0A0A0"> 741</span> <span style="color: #A0A0A0; background: #FFFFFF;">                SD = - Z*(RHZ(1:nn, 1:nn) \ Pd(1:nn,:));</span><br/>               <span style="color: #A0A0A0"> 742</span> <span style="color: #228B22; background: #FFFFFF;">                % Restore the warning states to their original settings</span><br/>               <span style="color: #A0A0A0"> 743</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warning(warningstate1)</span><br/>               <span style="color: #A0A0A0"> 744</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warning(warningstate2)</span><br/>               <span style="color: #A0A0A0"> 745</span> <span style="color: #A0A0A0; background: #FFFFFF;">                dirType = NewtonStep;</span><br/>               <span style="color: #A0A0A0"> 746</span> <span style="color: #228B22; background: #FFFFFF;">            else % steepest descent direction</span><br/>               <span style="color: #A0A0A0"> 747</span> <span style="color: #A0A0A0; background: #FFFFFF;">                SD = -Z*(Z'*gf);</span><br/>               <span style="color: #A0A0A0"> 748</span> <span style="color: #A0A0A0; background: #FFFFFF;">                dirType = SteepDescent;</span><br/>               <span style="color: #A0A0A0"> 749</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 750</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 751</span> <span style="color: #228B22; background: #FFFFFF;">    else % LP </span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 752</span> <span style="color: #000000; background: #FFFFFF;">        if ~simplex_iter </span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 753</span> <span style="color: #000000; background: #FFFFFF;">            SD = -Z*(Z'*gf); </span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 754</span> <span style="color: #000000; background: #FFFFFF;">            gradsd = norm(SD); </span><br/>               <span style="color: #A0A0A0"> 755</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 756</span> <span style="color: #A0A0A0; background: #FFFFFF;">            gradsd = Z'*gf;</span><br/>               <span style="color: #A0A0A0"> 757</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if  gradsd &gt; 0</span><br/>               <span style="color: #A0A0A0"> 758</span> <span style="color: #A0A0A0; background: #FFFFFF;">                SD = -Z;</span><br/>               <span style="color: #A0A0A0"> 759</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 760</span> <span style="color: #A0A0A0; background: #FFFFFF;">                SD = Z;</span><br/>               <span style="color: #A0A0A0"> 761</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 762</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 763</span> <span style="color: #000000; background: #FFFFFF;">        if abs(gradsd) &lt; 1e-10 % Search direction null </span><br/>               <span style="color: #A0A0A0"> 764</span> <span style="color: #228B22; background: #FFFFFF;">            % Check whether any constraints can be deleted from active set.</span><br/>               <span style="color: #A0A0A0"> 765</span> <span style="color: #228B22; background: #FFFFFF;">            % rlambda = -ACTSET'\gf;</span><br/>               <span style="color: #A0A0A0"> 766</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if ~oldind</span><br/>               <span style="color: #A0A0A0"> 767</span> <span style="color: #228B22; background: #FFFFFF;">                % Disable the warnings about conditioning for singular and</span><br/>               <span style="color: #A0A0A0"> 768</span> <span style="color: #228B22; background: #FFFFFF;">                % nearly singular matrices</span><br/>               <span style="color: #A0A0A0"> 769</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warningstate1 = warning('off', 'MATLAB:nearlySingularMatrix');</span><br/>               <span style="color: #A0A0A0"> 770</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warningstate2 = warning('off', 'MATLAB:singularMatrix');</span><br/>               <span style="color: #A0A0A0"> 771</span> <span style="color: #A0A0A0; background: #FFFFFF;">                rlambda = -R\(Q'*gf);</span><br/>               <span style="color: #A0A0A0"> 772</span> <span style="color: #228B22; background: #FFFFFF;">                % Restore the warning states to their original settings</span><br/>               <span style="color: #A0A0A0"> 773</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warning(warningstate1)</span><br/>               <span style="color: #A0A0A0"> 774</span> <span style="color: #A0A0A0; background: #FFFFFF;">                warning(warningstate2)</span><br/>               <span style="color: #A0A0A0"> 775</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTINDtmp = ACTIND; Qtmp = Q; Rtmp = R;</span><br/>               <span style="color: #A0A0A0"> 776</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 777</span> <span style="color: #228B22; background: #FFFFFF;">                % Reinsert just deleted constraint.</span><br/>               <span style="color: #A0A0A0"> 778</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTINDtmp = ACTIND;</span><br/>               <span style="color: #A0A0A0"> 779</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTINDtmp(lind+1:ACTCNT+1) = ACTIND(lind:ACTCNT);</span><br/>               <span style="color: #A0A0A0"> 780</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTINDtmp(lind) = oldind;</span><br/>               <span style="color: #A0A0A0"> 781</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [Qtmp,Rtmp] = qrinsert(Q,R,lind,A(oldind,:)');</span><br/>               <span style="color: #A0A0A0"> 782</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 783</span> <span style="color: #A0A0A0; background: #FFFFFF;">            actlambda = rlambda;</span><br/>               <span style="color: #A0A0A0"> 784</span> <span style="color: #A0A0A0; background: #FFFFFF;">            actlambda(1:neqcstr) = abs(actlambda(1:neqcstr));</span><br/>               <span style="color: #A0A0A0"> 785</span> <span style="color: #A0A0A0; background: #FFFFFF;">            indlam = find(actlambda &lt; errnorm);</span><br/>               <span style="color: #A0A0A0"> 786</span> <span style="color: #A0A0A0; background: #FFFFFF;">            lambda(indepInd(ACTINDtmp)) = normf * (rlambda./normA(ACTINDtmp));</span><br/><a name="Line787"></a>               <span style="color: #A0A0A0"> 787</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if ~length(indlam)</span><br/>               <span style="color: #A0A0A0"> 788</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 789</span> <span style="color: #A0A0A0; background: #FFFFFF;">                output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 790</span> <span style="color: #A0A0A0; background: #FFFFFF;">                return</span><br/>               <span style="color: #A0A0A0"> 791</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 792</span> <span style="color: #A0A0A0; background: #FFFFFF;">            cindmax = length(indlam);</span><br/>               <span style="color: #A0A0A0"> 793</span> <span style="color: #A0A0A0; background: #FFFFFF;">            cindcnt = 0;</span><br/>               <span style="color: #A0A0A0"> 794</span> <span style="color: #A0A0A0; background: #FFFFFF;">            m = length(ACTINDtmp);</span><br/>               <span style="color: #A0A0A0"> 795</span> <span style="color: #A0A0A0; background: #FFFFFF;">            while (abs(gradsd) &lt; 1e-10) &amp;&amp; (cindcnt &lt; cindmax)</span><br/>               <span style="color: #A0A0A0"> 796</span> <span style="color: #A0A0A0; background: #FFFFFF;">                cindcnt = cindcnt + 1;</span><br/>               <span style="color: #A0A0A0"> 797</span> <span style="color: #A0A0A0; background: #FFFFFF;">                lind = indlam(cindcnt);</span><br/>               <span style="color: #A0A0A0"> 798</span> <span style="color: #A0A0A0; background: #FFFFFF;">                [Q,R]=qrdelete(Qtmp,Rtmp,lind);</span><br/>               <span style="color: #A0A0A0"> 799</span> <span style="color: #A0A0A0; background: #FFFFFF;">                Z = Q(:,m:numberOfVariables);</span><br/>               <span style="color: #A0A0A0"> 800</span> <span style="color: #A0A0A0; background: #FFFFFF;">                if m ~= numberOfVariables</span><br/>               <span style="color: #A0A0A0"> 801</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    SD = -Z*Z'*gf;</span><br/>               <span style="color: #A0A0A0"> 802</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    gradsd = norm(SD);</span><br/>               <span style="color: #A0A0A0"> 803</span> <span style="color: #228B22; background: #FFFFFF;">                else</span><br/>               <span style="color: #A0A0A0"> 804</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    gradsd = Z'*gf;</span><br/>               <span style="color: #A0A0A0"> 805</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    if  gradsd &gt; 0</span><br/>               <span style="color: #A0A0A0"> 806</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        SD = -Z;</span><br/>               <span style="color: #A0A0A0"> 807</span> <span style="color: #228B22; background: #FFFFFF;">                    else</span><br/>               <span style="color: #A0A0A0"> 808</span> <span style="color: #A0A0A0; background: #FFFFFF;">                        SD = Z;</span><br/>               <span style="color: #A0A0A0"> 809</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    end</span><br/>               <span style="color: #A0A0A0"> 810</span> <span style="color: #A0A0A0; background: #FFFFFF;">                end</span><br/>               <span style="color: #A0A0A0"> 811</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 812</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if abs(gradsd) &lt; 1e-10  % Search direction still null</span><br/>               <span style="color: #A0A0A0"> 813</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTIND = indepInd(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 814</span> <span style="color: #A0A0A0; background: #FFFFFF;">                output.iterations = iterations;</span><br/>               <span style="color: #A0A0A0"> 815</span> <span style="color: #A0A0A0; background: #FFFFFF;">                return;</span><br/>               <span style="color: #A0A0A0"> 816</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 817</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTIND = ACTINDtmp;</span><br/>               <span style="color: #A0A0A0"> 818</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTIND(lind) = [];</span><br/>               <span style="color: #A0A0A0"> 819</span> <span style="color: #A0A0A0; background: #FFFFFF;">                aix = zeros(ncstr,1);</span><br/>               <span style="color: #A0A0A0"> 820</span> <span style="color: #A0A0A0; background: #FFFFFF;">                aix(ACTIND) = 1;</span><br/>               <span style="color: #A0A0A0"> 821</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTCNT = length(ACTIND);</span><br/>               <span style="color: #A0A0A0"> 822</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ACTSET = A(ACTIND,:);</span><br/>               <span style="color: #A0A0A0"> 823</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 824</span> <span style="color: #A0A0A0; background: #FFFFFF;">            lambda = zeros(origncstr,1);</span><br/>               <span style="color: #A0A0A0"> 825</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>       <span style="color: #0000FF">     83 </span><span style="color: #000000; font-weight: bold"> 826</span> <span style="color: #000000; background: #FFFFFF;">    end % if is_qp </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 827</span> <span style="color: #000000; background: #FFFFFF;">end % while  </span><br/>               <span style="color: #A0A0A0"> 828</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 829</span> <span style="color: #A0A0A0; background: #FFFFFF;">if iterations &gt;= maxiter</span><br/>               <span style="color: #A0A0A0"> 830</span> <span style="color: #A0A0A0; background: #FFFFFF;">    exitflag = 0;</span><br/>               <span style="color: #A0A0A0"> 831</span> <span style="color: #A0A0A0; background: #FFFFFF;">    how = 'MaxSQPIter';</span><br/>               <span style="color: #A0A0A0"> 832</span> <span style="color: #A0A0A0; background: #FFFFFF;">    msg = ...</span><br/>               <span style="color: #A0A0A0"> 833</span> <span style="color: #A0A0A0; background: #FFFFFF;">        sprintf(['Maximum number of iterations exceeded; increase options.MaxIter.\n' ...</span><br/>               <span style="color: #A0A0A0"> 834</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 'To continue solving the problem with the current solution as the\n' ...</span><br/>               <span style="color: #A0A0A0"> 835</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 'starting point, set x0 = x before calling ' caller '.']);</span><br/>               <span style="color: #A0A0A0"> 836</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if verbosity &gt; 0</span><br/>               <span style="color: #A0A0A0"> 837</span> <span style="color: #A0A0A0; background: #FFFFFF;">      disp(msg)</span><br/>               <span style="color: #A0A0A0"> 838</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 839</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 840</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 841</span> <span style="color: #A0A0A0; background: #FFFFFF;">output.iterations = iterations;</span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>